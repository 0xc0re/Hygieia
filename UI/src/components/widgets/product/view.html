<div id="product-dashboard">

    <div class="product-dash-header clearfix">
        <div class="product-dash-header-text">
            Averages and trends are calculated over a 90 Day period.
        </div>
        <div class="product-dash-header-legend clearfix">
            <span class="commit-blocks-legend town-city">
                <div class="commit-blocks-legend-block">
                    <div class="state"></div> 1000 commits
                </div>
                <div class="commit-blocks-legend-block">
                    <div class="city"></div> 100 commits
                </div>
                <div class="commit-blocks-legend-block">
                    <div class="town"></div> 10 commits
                </div>
                <div class="commit-blocks-legend-block">
                    <div class="village"></div> 1 commit
                </div>
            </span>
        </div>
    </div>

    <div class="product-table">
        <div class="product-table-tr">
            <div class="product-table-th"></div>
            <div class="product-table-th" ng-repeat="stage in ctrl.stages">{{stage}}</div>
        </div>
        <div class="product-table-tbody">
            <div class="product-table-tr team-row"
                ng-repeat="team in ctrl.configuredTeams">

                <div class="product-table-td team-name-cell">
                    <span class="fa fa-cog" ng-click="ctrl.editTeam(team)"></span>

                    <a title="{{item.customName || item.name}}" class="team-name" ng-click="ctrl.openDashboard(team)">
                        {{team.customName || team.name}}
                    </a>

                    <div class="team-quality">
                        <div class="team-quality-desc">
                            90-day Quality Metrics
                        </div>

                        <div class="row">
                            {{teamSummaryMetrics = ctrl.getTeamSummaryMetrics(team.collectorItemId);""}}
                            <div class="col-xs-4">
                                <span class="quality-cell-wrapper">
                                    <div class="quality-num">
                                        <span class="fa fa-long-arrow-up text-success"></span>
                                        {{teamSummaryMetrics.codeCoverage.number}}<sup>%</sup>
                                    </div>
                                    <div class="quality-text">
                                        Code coverage
                                    </div>
                                </span>
                            </div>
                            <div class="col-xs-4 text-center">
                                <span class="quality-cell-wrapper">
                                    <div class="quality-num">
                                        <span class="fa fa-long-arrow-down text-danger"></span>
                                        {{teamSummaryMetrics.funcTestsPassed.number}}<sup>%</sup>
                                    </div>
                                    <div class="quality-text">
                                        Func tests passed
                                    </div>
                                </span>
                            </div>
                            <div class="col-xs-4 text-right">
                                <span class="quality-cell-wrapper">
                                    <div class="quality-num">
                                        <span class="fa fa-long-arrow-up text-danger"></span>
                                        {{teamSummaryMetrics.numberCodeIssues.number}}
                                    </div>
                                    <div class="quality-text">
                                        # of code issues
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="product-table-td team-data-cell"
                    ng-repeat="stage in ctrl.stages | filter: '!PROD'">
                    {{teamData = team.stages[stage].summary;""}}
                    <div class="team-data-cell-content" ng-if="teamData" ng-click="ctrl.viewTeamStageDetails(team, stage)">
                        <div class="team-data-cell-header">
                            <div class="clearfix" ng-if-start="teamData.average != false">
                                <!-- only leading zeros get small size -->
                                <span class="team-time-average-lg" ng-if="teamData.average.days">{{teamData.average.days}}</span>
                                <span class="team-time-average-desc" ng-if="teamData.average.days > 0">D</span>
                                <span class="team-time-average-lg" ng-if="teamData.average.hours > 0 || teamData.average.days > 0">{{teamData.average.hours}}</span>
                                <span class="team-time-average-desc" ng-if="teamData.average.hours > 0 || teamData.average.days > 0">H</span>
                                <span class="team-time-average-lg">{{teamData.average.minutes}}</span>
                                <span class="team-time-average-desc">M</span>
                            </div>
                            <div class="clearfix team-time-average" ng-if-end>
                                <span class="pull-left">Average</span>
                                    <span class="pull-right">
                                        <span>+/-</span>
                                        <span class="team-time-stddev-num">{{teamData.deviation.number}}</span>
                                        <span class="team-time-stddev-desc">{{teamData.deviation.descriptor}}</span>
                                    </span>
                            </div>

                            <div class="clearfix" ng-if-start="teamData.average == false">
                                <span class="team-time-average-lg">--</span>
                            </div>
                            <div class="clearfix team-time-average" ng-if-end>
                                <span class="pull-left">Calculating</span>
                            </div>
                        </div>

                        <div class="team-data-cell-body">
                            <div class="team-data-cell-last-updated" title="{{teamData.lastUpdated.longDisplay}}" ng-if="teamData.lastUpdated">
                                Updated: <span class="team-last-updated-num">{{teamData.lastUpdated.shortDisplay}}</span>
                            </div>

                            <commit-blocks commit-fail="teamData.commitsOutsideTimeframe" commit-pass="teamData.commitsInsideTimeframe"></commit-blocks>
                        </div>

                        <div class="team-data-cell-last-build" ng-if="stage === 'Build'">
                            {{build = ctrl.getLatestBuildInfo(team.collectorItemId);""}}
                            Latest build #: <span class="fa" ng-class="{'text-success fa-thumbs-up': build.success, 'text-danger fa-thumbs-down': !build.success}"></span> <span class="team-data-cell-last-build-num">{{build.number}}</span>
                        </div>
                    </div>

                </div>

                <div class="product-table-td team-prod-cell">
                    <div class="clearfix team-prod-average-header">
                        <span class="pull-left team-prod-arrow fa fa-long-arrow-down text-danger"></span>
                        <span class="pull-left product-text-active">10</span>
                        <span class="pull-left team-prod-average-days">DAY</span>
                    </div>

                    <div class="team-prod-average-desc">
                        average from commit to production
                    </div>

                    <div class="team-prod-last-90">
                        <span class="team-prod-last-90-num">90</span>
                        commits in the last <span class="widget-font-bold">3 days</span>
                    </div>
                </div>
            </div>
            <div
                class="product-table-tr new-team-row"
                ng-class="{'no-teams': !ctrl.configuredTeams.length}"
                ng-click="ctrl.addTeam()">
                <div class="product-table-td">
                    <span class="fa fa-plus fa-thin-border"></span>
                    <div>Add a team</div>
                </div>
                <div class="product-table-td" ng-repeat="stages in ctrl.stages"></div>
            </div>
        </div>
    </div>

</div>