<div id="product-dashboard">

    <div class="product-dash-header clearfix">
        <div class="product-dash-header-text">
            Averages and trends are calculated over a 90 Day period.
        </div>
        <div class="product-dash-header-legend clearfix">
            <span class="commit-blocks-legend town-city">
                <div class="commit-blocks-legend-block">
                    <div class="state"></div> 1000 commits
                </div>
                <div class="commit-blocks-legend-block">
                    <div class="city"></div> 100 commits
                </div>
                <div class="commit-blocks-legend-block">
                    <div class="town"></div> 10 commits
                </div>
                <div class="commit-blocks-legend-block">
                    <div class="village"></div> 1 commit
                </div>
            </span>
        </div>
    </div>

    <div>
        <table class="product-table">
            <thead>
            <tr>
                <th></th>
                <th ng-repeat="stage in ctrl.stages">{{stage}}</th>
            </tr>
            </thead>
            <tbody>
            <tr class="team-row"
                ng-repeat="team in ctrl.configuredTeams">

                <td class="team-name-cell">
                    <span class="fa fa-cog" ng-click="ctrl.editTeam(team)"></span>

                    <a title="{{item.customName || item.name}}" class="team-name" ng-click="ctrl.openDashboard(team)">
                        {{team.customName || team.name}}
                    </a>

                    <div class="team-quality">
                        <div class="team-quality-desc">
                            90-day Quality Metrics
                        </div>

                        <div class="row">
                            <div class="col-xs-4">
                                    <span class="quality-cell-wrapper">
                                        <div class="quality-num">
                                            <span class="fa fa-long-arrow-up text-success"></span>
                                            80%
                                        </div>
                                        <div class="quality-text">
                                            Func tests passed
                                        </div>
                                    </span>
                            </div>
                            <div class="col-xs-4 text-center">
                                    <span class="quality-cell-wrapper">
                                        <div class="quality-num">
                                            <span class="fa fa-long-arrow-down text-danger"></span>
                                            92%
                                        </div>
                                        <div class="quality-text">
                                            Build success rate
                                        </div>
                                    </span>
                            </div>
                            <div class="col-xs-4 text-right">
                                    <span class="quality-cell-wrapper">
                                        <div class="quality-num">
                                            <span class="fa fa-long-arrow-up text-success"></span>
                                            0:43
                                        </div>
                                        <div class="quality-text">
                                            Avg time to fix
                                        </div>
                                    </span>
                            </div>
                        </div>
                    </div>
                </td>

                <td class="team-data-cell"
                    ng-repeat="stage in ctrl.stages | filter: '!PROD'">
                    {{teamData = team.stages[stage].summary;""}}
                    <div class="team-data-cell-content" ng-if="teamData" ng-click="ctrl.viewTeamStageDetails(team, stage)">
                        <div class="team-data-cell-header">
                            <div class="clearfix" ng-if-start="teamData.average != false">
                                <!-- only leading zeros get small size -->
                                <span class="team-time-average-lg" ng-if="teamData.average.days">{{teamData.average.days}}</span>
                                <span class="team-time-average-desc" ng-if="teamData.average.days > 0">D</span>
                                <span class="team-time-average-lg" ng-if="teamData.average.hours > 0 || teamData.average.days > 0">{{teamData.average.hours}}</span>
                                <span class="team-time-average-desc" ng-if="teamData.average.hours > 0 || teamData.average.days > 0">H</span>
                                <span class="team-time-average-lg" ng-if="teamData.average.hours > 0">{{teamData.average.minutes}}</span>
                                <span class="team-time-average-desc">M</span>
                            </div>
                            <div class="clearfix team-time-average" ng-if-end>
                                <span class="pull-left">Average</span>
                                <span class="pull-right">
                                    <span>+/-</span>
                                    <span class="team-time-stddev-num">{{teamData.deviation.number}}</span>
                                    <span class="team-time-stddev-desc">{{teamData.deviation.descriptor}}</span>
                                </span>
                            </div>

                            <div class="clearfix" ng-if-start="teamData.average == false">
                                <span class="team-time-average-lg">--</span>
                            </div>
                            <div class="clearfix team-time-average" ng-if-end>
                                <span class="pull-left">Calculating</span>
                            </div>
                        </div>

                        <div class="team-data-cell-body">
                            <div class="team-data-cell-last-updated" title="{{teamData.lastUpdated.longDisplay}}">
                                Updated: <span class="team-last-updated-num">{{teamData.lastUpdated.shortDisplay}}</span>
                            </div>

                            <commit-blocks commit-fail="teamData.commitsOutsideTimeframe" commit-pass="teamData.commitsInsideTimeframe"></commit-blocks>
                        </div>

                        <!--<div class="team-data-cell-last-build">-->
                        <!--Latest build #: <span class="team-data-cell-last-build-num">73</span>-->
                        <!--</div>-->
                    </div>

                </td>

                <td class="team-prod-cell">
                    <div class="clearfix team-prod-average-header">
                        <span class="pull-left team-prod-arrow fa fa-long-arrow-down text-danger"></span>
                        <span class="pull-left product-text-active">10</span>
                        <span class="pull-left team-prod-average-days">DAY</span>
                    </div>
                    <div class="team-prod-average-desc">
                        average from commit to production
                    </div>

                    <div class="team-prod-last-90">
                        <span class="team-prod-last-90-num">90</span>
                        commits in the last <span class="widget-font-bold">3 days</span>
                    </div>
                </td>
            </tr>
            <tr
                class="new-team-row"
                ng-class="{'no-teams': !ctrl.configuredTeams.length}"
                ng-click="ctrl.addTeam()">
                <td>
                    <span class="fa fa-plus fa-thin-border"></span>
                    <div>Add a team</div>
                </td>
                <td ng-repeat="stages in ctrl.stages"></td>
            </tr>
            </tbody>
        </table>
    </div>

</div>